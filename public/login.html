<button id="login">Login with Discord</button>
<div id="status"></div>

<script type="module">
  import { createClient } from "https://esm.sh/@supabase/supabase-js";

  const supabase = createClient(
    "https://msgozdhtfawuadxerkxq.supabase.co",
    "sb_publishable_wnNxDxsZA_SazdahnpMiIg__zR2QQvv",
    {
      auth: {
        flowType: "pkce",
        detectSessionInUrl: true,
      },
    }
  );

  async function checkAuth() {
    const { data: { user } } = await supabase.auth.getUser();

    if (user) {
      document.getElementById("status").textContent =
        `Logged in as ${user.email ?? user.user_metadata?.full_name ?? "Discord user"}`;
      document.getElementById("login").style.display = "none";
    } else {
      document.getElementById("status").textContent = "Not logged in.";
      document.getElementById("login").style.display = "";
    }
  }

  document.getElementById("login").onclick = async () => {
    await supabase.auth.signInWithOAuth({
      provider: "discord",
      options: {
        redirectTo: `${window.location.origin}/auth/callback`,
      },
    });
  };

  window.addEventListener("DOMContentLoaded", async () => {
    await checkAuth();
  });
</script>