<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tree Clipper</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="login-corner"></div>
    <h1>Tree Clipper</h1>
    
    <ul id="assets-list" class="assets-list">
        <li class="loading-item">Loading assets...</li>
    </ul>

    <a href="upload-asset.html" class="upload-btn">+ Upload Asset</a>

    <div style="height: 16px;"></div>
    <div class="prototype-warning">‚ö†Ô∏è Early Prototype. Work in progress. All data will be deleted every few hours.</div>
    
    <footer class="site-footer">
        <a href="terms.html">Terms</a> ¬∑ <a href="imprint.html">Imprint</a>
    </footer>
    
    <script type="module">
        async function loadAssets() {
            const listEl = document.getElementById("assets-list");
            
            try {
                const res = await fetch("/api/entries");
                const entries = await res.json();
                
                if (!entries || entries.length === 0) {
                    listEl.innerHTML = '<li class="empty-item">No assets yet. Be the first to upload!</li>';
                    return;
                }
                
                listEl.innerHTML = entries.map(entry => {
                    const title = entry.title || "Untitled Asset";
                    const author = entry.author || "Unknown";
                    const imageUrl = entry.image_data;
                    const imageHtml = imageUrl 
                        ? `<img src="${escapeHtml(imageUrl)}" alt="" class="asset-thumb" loading="lazy">`
                        : `<div class="asset-thumb-placeholder">üì¶</div>`;
                    
                    // Build tags HTML
                    let tagsHtml = '';
                    if (entry.node_type || entry.blender_version) {
                        tagsHtml = '<div class="asset-tags">';
                        if (entry.node_type) {
                            const nodeLabel = formatNodeType(entry.node_type);
                            const nodeIcon = getNodeTypeIcon(entry.node_type);
                            tagsHtml += `<span class="asset-tag asset-tag--${entry.node_type}">${nodeIcon} ${nodeLabel}</span>`;
                        }
                        if (entry.blender_version) {
                            tagsHtml += `<span class="asset-tag asset-tag--blender">Blender ${escapeHtml(entry.blender_version)}</span>`;
                        }
                        tagsHtml += '</div>';
                    }
                    
                    return `
                        <li>
                            <a href="asset.html?id=${encodeURIComponent(entry.asset_id)}">
                                ${imageHtml}
                                <div class="asset-info">
                                    <span class="asset-title">${escapeHtml(title)}</span>
                                    <span class="asset-author">by @${escapeHtml(author)}</span>
                                    ${tagsHtml}
                                </div>
                            </a>
                        </li>
                    `;
                }).join('');
                
            } catch (err) {
                console.error("Failed to load assets:", err);
                listEl.innerHTML = '<li class="error-item">Failed to load assets. Please try again later.</li>';
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function formatNodeType(nodeType) {
            const labels = {
                'geonodes': 'Geo Nodes',
                'shader': 'Shader',
                'compositor': 'Compositor'
            };
            return labels[nodeType] || nodeType;
        }
        
        function getNodeTypeIcon(nodeType) {
            const icons = {
                'geonodes': '‚óá',
                'shader': '‚óê',
                'compositor': '‚ñ£'
            };
            return icons[nodeType] || '‚óè';
        }
        
        loadAssets();
    </script>
    
    <script type="module" src="auth.js"></script>
</body>
</html>
